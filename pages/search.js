import React, { useState, useEffect } from 'react';
// import { getTrendingData } from '../api';
import Head from 'next/head';
import 'antd/dist/reset.css';
import axios from "axios";
import CustomHeader from '../components/CustomHeader';
import Cards from '../components/Cards';
import { Layout, theme, Spin, Input, Tabs } from 'antd';
import routes from '../routes';
import { AndroidOutlined, AppleOutlined } from '@ant-design/icons';

const { Content, Footer } = Layout;
const { Search } = Input;

process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';

const SearchPage = () => {
  const [moviePage, setMoviePage] = useState(1);
  const [tvPage, setTvPage] = useState(1);
  const [searchResultsMovieData, setSearchResultsMovieData] = useState([]);
  const [searchResultsTvData, setSearchResultsTvData] = useState([]);
  const [activeTab, setActiveTab] = useState('movie');
  const [searchInput, setSearchInput] = useState('');
  // const [load, setLoad] = useState(false);
  // const [showError, setShowError] = useState(false);

  const {
    token: { colorBgContainer },
  } = theme.useToken();


  const onSearch = async(value) => {
    console.log(value)
    setSearchInput(() => value);
    console.log('input', searchInput)
    // await getSearchResultsData(page);
  }

  const onTabChange = (key) => {
    // console.log(key)
    setActiveTab(key)
  }

  const getSearchMovieResultsData = async(pageNumber) => {
    console.log('start')
    if (searchInput === '') return;
    const searchMovieResultsUrl = routes.getSearchResults('movie', searchInput, pageNumber);
    const searchMovieResultsRes = await axios.get(searchMovieResultsUrl);
    setSearchResultsMovieData(() => searchMovieResultsRes.data.results.map((el) => ({ ...el, 'media_type': 'movie' })));
    console.log('stop') 
  }

  const getSearchTvResultsData = async(pageNumber) => {
    console.log('start')
    if (searchInput === '') return;
    const searchTvResultsUrl = routes.getSearchResults('tv', searchInput, pageNumber);
    const searchTvResultsRes = await axios.get(searchTvResultsUrl); 
    setSearchResultsTvData(() => searchTvResultsRes.data.results.map((el) => ({ ...el, 'media_type': 'tv' })));
    console.log('stop') 
  }

  // const openCard = async (id) => {
  //   let mediaObj = trendingData.filter((el) => el.id === id)[0];
  //   const videosUrl = routes.getVideosPath(mediaObj.media_type, id);
  //   const actorsUrl = routes.getActorsPath(mediaObj.media_type, id);
  //   const videoRes = await axios.get(videosUrl);
  //   const actorsRes = await axios.get(actorsUrl);
  //   const videoLink = videoRes.data.results[0].key;
  //   const actorsData = actorsRes.data.cast.slice(0, 10);
  //   mediaObj = { ...mediaObj, videoLink, acrotrsData: actorsData };

  //   setActiveItemData(mediaObj);
  //   // try {
  //     // const res = await axios.get(uri);
  //     // setActivePictureData(res.data);
  //     setShowModal(true);
  //   // } catch (error) {
  //   //   setShowErrorBlock(true);
  //   //   throw error;
  //   // }   
  // };

  useEffect(() => {
    getSearchMovieResultsData(moviePage)
    console.log('here')
  }, [searchInput, moviePage]);

  useEffect(() => {
    getSearchTvResultsData(tvPage)
    console.log('here')
  }, [searchInput, tvPage]);

  const onMoviePaginationChange = (current) => {
    setMoviePage(current);
  };

  const onTvPaginationChange = (current) => {
    console.log('jee')
    setTvPage(current);
  };
  
  return (
    <Layout>
      <Head>
        <title>Search</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <CustomHeader />
      {/* <Spin tip="Loading" size="large">
        <div className="content" />
      </Spin> */}
       <Content
        style={{
          padding: '0 50px',
        }}
      >
        <Layout
          style={{
            padding: '24px 0',
            background: colorBgContainer,
          }}
        >
          <Search
            placeholder="input search text"
            onSearch={onSearch}
            style={{
              width: 400,
              margin: 'auto'
            }}
          />
          <Tabs
            defaultActiveKey={activeTab}
            style={{
              margin: 'auto'
            }}
            onChange={onTabChange}
            items={[
              {
                label: (<span><AppleOutlined />Movies</span>),
                key: 'movie',
                children: (<Cards data={searchResultsMovieData} onPaginationChange={onMoviePaginationChange} page={moviePage} />),
              },
              {
                label: (<span><AndroidOutlined />TV</span>),
                key: 'tv',
                children: (<Cards data={searchResultsTvData} onPaginationChange={onTvPaginationChange} page={tvPage} />),
              }]}
          />
          {/* {renderModal()} */}
        </Layout>
      </Content>
      <Footer style={{textAlign: 'center'}}>
        Cinema Â©2022 Created by pavl1k
      </Footer>
    </Layout>
  );
};

export default SearchPage;
